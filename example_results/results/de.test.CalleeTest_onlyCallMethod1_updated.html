<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Performance Measurement Tree</title>

    <style>
	
	.node {
		cursor: pointer;
	}

	.node circle {
	  fill: #fff;
	  stroke: steelblue;
	  stroke-width: 3px;
	}

	.node text {
	  font: 12px sans-serif;
	}

	.link {
	  fill: none;
	  stroke: #ccc;
	  stroke-width: 2px;
	}
	
    </style>

  </head>

  <body>

<script src="plotly-latest.min.js"></script><div style='position:absolute; right: 0px; width: 800px; background-color: #BBBBBB; border: 2px solid blue; border-radius: 1em 1em 1em 1em; padding: 1em;'>
Version: 9caed514e0759dbfa4ef29acca78787e34d99975<br>
Test Case: de.test.CalleeTest#onlyCallMethod1<br>
</div>
<div style='position:absolute; left: 0px; width: 800px; height: 100px; background-color: #BBBBBB; border: 2px solid blue; border-radius: 1em 1em 1em 1em; padding: 1em;' id='infos'>
Statistische Informationen
</div>
<div style='position:absolute; bottom: 0px; width: 600px; height: 300px; background-color: #BBBBBB; border: 2px solid blue; border-radius: 1em 1em 1em 1em; padding: 1em;' id='histogramm'>
Plot
</div>
<div style='position:absolute; bottom: 0px; right:0px; overflow: scroll; width: 1000px; height: 300px; background-color: #BBBBBB; border: 2px solid blue; border-radius: 1em 1em 1em 1em; padding: 1em;' id='quelltext'>
Quelltext
</div>
<div id='tree' style='position: absolute; top: 150px; right: 5px; left: 5px; bottom: 335px; overflow: scroll; border: 2px solid blue; border-radius: 1em 1em 1em 1em;'> </div>
<script>
var treeData = [
{
  "name" : "CalleeTest#onlyCallMethod1",
  "parent" : null,
  "children" : [ {
    "name" : "Callee#<init>",
    "parent" : "CalleeTest#onlyCallMethod1",
    "children" : [ ],
    "color" : "#FFFFFF",
    "statistic" : {
      "meanOld" : 25.556681924295486,
      "meanCurrent" : 28.83359451864739,
      "deviationOld" : 1.5836356053068976,
      "deviationCurrent" : 1.0768099476673874,
      "vms" : 60,
      "tvalue" : -9.372276180768218,
      "change" : true
    },
    "values" : [ 28.218000000000075, 29.206499999999956, 29.245500000000025, 30.60599999999998, 27.54999999999995, 27.737368684342186, 28.345172586293184, 27.48249999999995, 27.538500000000116, 29.193096548274177, 28.61299999999997, 29.850500000000064, 27.987000000000016, 29.283283283283268, 27.914999999999974, 28.50975487743873, 27.26963481740873, 29.961500000000036, 28.33116558279142, 28.92049999999998, 29.502999999999982, 31.276499999999988, 28.07553776888448, 28.593500000000024, 27.83650000000005, 30.10350000000001, 28.60730365182588, 28.419709854927504, 31.212500000000134, 29.615807903951932 ],
    "valuesPredecessor" : [ 24.531765882941453, 22.895000000000056, 22.28914457228611, 23.457000000000026, 26.225000000000016, 25.381499999999992, 24.63231615807905, 26.33166583291654, 25.045022511255645, 25.680000000000057, 24.193500000000025, 25.676838419209584, 27.773999999999987, 26.55700000000001, 24.198000000000036, 25.123561780890398, 25.19209604802398, 25.412999999999943, 24.988494247123548, 27.195, 26.21900000000005, 26.220999999999993, 27.53449999999995, 24.221999999999984, 24.90300000000001, 26.840420210105076, 26.264132066033046, 30.572999999999986, 25.536000000000012, 25.6075 ]
  }, {
    "name" : "Callee#method1",
    "parent" : "CalleeTest#onlyCallMethod1",
    "children" : [ {
      "name" : "Callee#innerMethod",
      "parent" : "Callee#method1",
      "children" : [ ],
      "color" : "#FF0000",
      "statistic" : {
        "meanOld" : 5134.9582,
        "meanCurrent" : 15143.138950000002,
        "deviationOld" : 2.7197327695812805,
        "deviationCurrent" : 3.485858466351848,
        "vms" : 60,
        "tvalue" : -12398.320936843946,
        "change" : true
      },
      "values" : [ 15143.036499999982, 15138.836499999985, 15140.768999999997, 15141.47850000001, 15140.573499999995, 15144.054000000016, 15149.111500000005, 15139.893500000015, 15135.855499999992, 15145.862499999976, 15141.537000000011, 15147.017999999995, 15142.939000000026, 15146.94750000001, 15141.895, 15142.487500000001, 15148.45500000004, 15144.492999999975, 15146.348999999998, 15147.117000000024, 15140.105000000003, 15142.156999999996, 15136.411999999993, 15147.442999999994, 15142.128500000008, 15145.415000000014, 15142.425500000007, 15148.042999999985, 15142.097499999969, 15139.232999999977 ],
      "valuesPredecessor" : [ 5130.054999999996, 5131.994499999997, 5136.615499999995, 5132.467499999998, 5132.701000000005, 5136.126999999994, 5133.516000000008, 5138.848500000003, 5133.975499999995, 5135.8670000000075, 5140.569000000007, 5136.27000000001, 5136.808999999987, 5136.430999999997, 5139.250499999994, 5131.968999999989, 5133.80899999999, 5132.927500000008, 5134.418499999994, 5137.374000000014, 5139.077499999998, 5135.706000000008, 5138.310999999996, 5135.127000000004, 5134.515499999994, 5133.120000000007, 5132.998500000009, 5131.136000000007, 5130.758999999991, 5136.000499999998 ]
    } ],
    "color" : "#FF0000",
    "statistic" : {
      "meanOld" : 5136.481,
      "meanCurrent" : 15144.676849999994,
      "deviationOld" : 3.4500519911131096,
      "deviationCurrent" : 2.6082694955060117,
      "vms" : 60,
      "tvalue" : -12674.38186485153,
      "change" : true
    },
    "values" : [ 15147.043500000013, 15145.155999999974, 15142.97799999997, 15146.141999999993, 15142.069499999996, 15140.084500000023, 15142.373999999996, 15143.389999999967, 15139.774999999994, 15148.326999999974, 15144.864000000012, 15145.70299999997, 15142.268, 15146.245499999975, 15143.221499999992, 15143.316499999966, 15143.435000000023, 15149.057500000014, 15144.242000000004, 15146.750999999991, 15146.723000000015, 15146.41950000001, 15142.414000000012, 15141.820499999996, 15141.778000000018, 15149.726999999966, 15144.848000000029, 15145.479499999985, 15149.13749999999, 15145.515000000005 ],
    "valuesPredecessor" : [ 5136.977500000008, 5132.934000000006, 5132.780000000025, 5134.138000000006, 5134.127500000007, 5137.264499999989, 5137.045, 5135.490499999993, 5134.971500000008, 5135.788999999996, 5132.565999999983, 5132.415499999992, 5142.410499999999, 5139.703000000012, 5134.15399999999, 5135.257999999989, 5129.3394999999955, 5138.545499999983, 5133.3714999999975, 5143.472000000007, 5138.561500000002, 5139.856000000016, 5137.347000000008, 5134.003499999993, 5138.195499999998, 5140.387999999997, 5137.9780000000055, 5144.185999999989, 5136.215500000005, 5134.9459999999945 ]
  } ],
  "color" : "#FF0000",
  "statistic" : {
    "meanOld" : 5172.959896666667,
    "meanCurrent" : 15184.454213036783,
    "deviationOld" : 6.548221463959692,
    "deviationCurrent" : 5.623591940271972,
    "vms" : 60,
    "tvalue" : -6352.867021754184,
    "change" : true
  },
  "values" : [ 15167.446391103675, 15187.623499999994, 15187.860999999983, 15177.467499999977, 15176.965499999982, 15180.844999999978, 15182.045499999958, 15185.086500000018, 15183.921999999997, 15179.97649999997, 15190.440500000008, 15185.086999999998, 15194.44899999999, 15184.520500000022, 15189.245499999997, 15187.434000000045, 15186.07799999997, 15182.349, 15184.858500000018, 15189.293499999969, 15181.742500000002, 15187.590499999995, 15191.40999999998, 15182.762499999979, 15187.591000000011, 15195.458500000019, 15184.105000000001, 15178.828499999987, 15179.614, 15181.528999999979 ],
  "valuesPredecessor" : [ 5159.828899999966, 5169.967500000017, 5181.890500000021, 5169.188999999996, 5180.233000000015, 5166.13800000001, 5180.445500000008, 5177.07299999999, 5174.396000000007, 5177.380500000015, 5179.071499999995, 5172.391999999982, 5160.883500000009, 5171.7815, 5155.240499999996, 5168.093500000006, 5171.932499999999, 5172.474999999991, 5172.071499999981, 5177.646000000007, 5171.548, 5179.7440000000015, 5176.65649999999, 5169.486499999998, 5176.425499999998, 5178.800999999994, 5182.191000000001, 5174.735499999993, 5168.5910000000085, 5172.488499999996 ]
}];
var source = {"Callee#<init>": `public Callee() {
    System.out.println("Constructor");
}`,"CalleeTest#onlyCallMethod1": `@Test
public void onlyCallMethod1() {
    final Callee callee = new Callee();
    callee.method1();
    Assert.assertNotNull(callee);
}`,"Callee#method1": `public void method1() {
    innerMethod();
}`,"Callee#innerMethod": `private void innerMethod() {										private void innerMethod() {
    try {												    try {
        Thread.sleep(5);									   |	        Thread.sleep(15);
    } catch (final InterruptedException e) {								    } catch (final InterruptedException e) {
        e.printStackTrace();										        e.printStackTrace();
    }													    }
}													}
`,};
// ************** Generate the tree diagram   *****************
var margin = {top: 20, right: 120, bottom: 20, left: 260},
   width = 1000- margin.right - margin.left,
   height = 140 - margin.top - margin.bottom;</script>

<!-- load the d3.js library -->	
<script src="d3.v3.min.js"></script>
	
<script>
	
var i = 0,
	duration = 750,
	root;

var tree = d3.layout.tree()
	.size([height, width]);

var diagonal = d3.svg.diagonal()
	.projection(function(d) { return [d.y, d.x]; });

var svg = d3.select("#tree").append("svg")
	.attr("width", width + margin.right + margin.left)
	.attr("height", height + margin.top + margin.bottom)
  .append("g")
	.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

root = treeData[0];
root.x0 = height / 2;
root.y0 = 0;
  
update(root);

d3.select(self.frameElement).style("height", "500px");

function update(source) {

  // Compute the new tree layout.
  var nodes = tree.nodes(root).reverse(),
	  links = tree.links(nodes);

  // Normalize for fixed-depth.
  nodes.forEach(function(d) { d.y = d.depth * 180; });

  // Update the nodes…
  var node = svg.selectAll("g.node")
	  .data(nodes, function(d) { return d.id || (d.id = ++i); });

  // Enter any new nodes at the parent's previous position.
  var nodeEnter = node.enter().append("g")
	  .attr("class", "node")
	  .attr("transform", function(d) { return "translate(" + source.y0 + "," + source.x0 + ")"; })
	  .on("click", click)
	  .on("mouseover", shownode);

  nodeEnter.append("circle")
	  .attr("r", 1e-6)
	  .style("fill", function(d) { return d.color; });

  nodeEnter.append("text")
	  .attr("x", function(d) { return d.children || d._children ? -13 : 13; })
	  .attr("dy", ".35em")
	  .attr("text-anchor", function(d) { return d.children || d._children ? "end" : "start"; })
	  .text(function(d) { return d.name; })
	  .style("fill-opacity", 1e-6);

  // Transition nodes to their new position.
  var nodeUpdate = node.transition()
	  .duration(duration)
	  .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; });

  nodeUpdate.select("circle")
	  .attr("r", 10)
	  .style("fill", function(d) { return d.color; });

  nodeUpdate.select("text")
	  .style("fill-opacity", 1);

  // Transition exiting nodes to the parent's new position.
  var nodeExit = node.exit().transition()
	  .duration(duration)
	  .attr("transform", function(d) { return "translate(" + source.y + "," + source.x + ")"; })
	  .remove();

  nodeExit.select("circle")
	  .attr("r", 1e-6);

  nodeExit.select("text")
	  .style("fill-opacity", 1e-6);

  // Update the links…
  var link = svg.selectAll("path.link")
	  .data(links, function(d) { return d.target.id; });

  // Enter any new links at the parent's previous position.
  link.enter().insert("path", "g")
	  .attr("class", "link")
	  .attr("d", function(d) {
		var o = {x: source.x0, y: source.y0};
		return diagonal({source: o, target: o});
	  });

  // Transition links to their new position.
  link.transition()
	  .duration(duration)
	  .attr("d", diagonal);

  // Transition exiting nodes to the parent's new position.
  link.exit().transition()
	  .duration(duration)
	  .attr("d", function(d) {
		var o = {x: source.x, y: source.y};
		return diagonal({source: o, target: o});
	  })
	  .remove();

  // Stash the old positions for transition.
  nodes.forEach(function(d) {
	d.x0 = d.x;
	d.y0 = d.y;
  });
}

// Toggle children on click.
function click(d) {
  if (d.children) {
	d._children = d.children;
	d.children = null;
  } else {
	d.children = d._children;
	d._children = null;
  }
  update(d);
}

function round(value){
	return Math.round(value*100)/100;
}

function shownode(node) {
  infos.innerHTML="<table>" +
      "<tr><th>Predecessor</th><th>Current</th></tr>"+
      "<tr><td>" + round(node.statistic.meanOld) +    "</td><td>" + round(node.statistic.meanCurrent)+"</td></tr>"+
      "<tr><td>" + round(node.statistic.deviationOld)+"</td><td>" + round(node.statistic.deviationCurrent)+"</td></tr>"+
      "</table> VMs: " + node.statistic.vms +
      " T=" + round(node.statistic.tvalue);
  quelltext.innerHTML="<pre>" + source[node.name] +"</pre>"
  histogramm.innerHTML=node.name;
  var version = {
    x: node.values,
    type: "histogram",
    name: "Version",
    opacity: 0.5,
    marker: {
     color: 'green',
    },
  };
  var predecessor = {
    x: node.valuesPredecessor,
    type: "histogram",
    name: "Predecessor",
    opacity: 0.6,
    marker: {
     color: 'red',
    },
  };
  var data = [version, predecessor];
  var layout = {barmode: "overlay", 
			title: { text: "Histogramm"},
			xaxis: { title: { text: "Duration / Mikroseconds"} },
			yaxis: { title: { text: "Frequency"} }
		  };
  Plotly.newPlot("histogramm", data, layout);
}

shownode(root);

</script>
	
  </body>
</html>

